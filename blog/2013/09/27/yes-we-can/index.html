  <!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="author" content="Calum Halcrow">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="A layout example that shows off a blog page with a list of posts.">

    <title>Yes we can, yes we cancan - Calum Halcrow</title>

    
    <meta name="description" content="Yes we can, yes we cancan Sep 27th, 2013 cancan is an authentication gem for Rails. It can be used to restrict access to certain parts of your web- &hellip;">
    

    <!-- http://t.co/dKP3o1e -->
    <meta name="HandheldFriendly" content="True">
    <meta name="MobileOptimized" content="320">
    <meta name="viewport" content="width=device-width, initial-scale=1">

    
    <link rel="canonical" href="http://calumhalcrow.com/blog/2013/09/27/yes-we-can">
    <link href="/favicon.png" rel="icon">
    <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
    <link href="/atom.xml" rel="alternate" title="Calum Halcrow" type="application/atom+xml">
    <script src="/javascripts/modernizr-2.0.js"></script>
    <script src="//ajax.googleapis.com/ajax/libs/jquery/1.9.1/jquery.min.js"></script>
    <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
    <script src="/javascripts/octopress.js" type="text/javascript"></script>
  </head>

  
  <body>
    <div id="layout" class="pure-g">
      <div class="sidebar pure-u-1 pure-u-md-1-4">
  <div class="header">
    <h1 class="brand-title"><a href="/">Calum Halcrow</a></h1>
    <h2 class="brand-tagline">Web developer based in KL, MY.</h2>

    <nav class="nav">
      <ul class="nav-list">
        <li class="nav-item">
          <a class="pure-button" href="/about">About</a>
        </li>
        <li class="nav-item">
          <a class="pure-button" href="/projects">Projects</a>
        </li>
        <li class="nav-item">
          <a class="pure-button" href="http://github.com/calumhalcrow" target="_new">Github</a>
        </li>
      </ul>
    </nav>
  </div>
</div>


      <div class="content pure-u-1 pure-u-md-3-4">
        <div>
          <div>
  <article role="article">
    
    <header class="post-header">
  
    <h2 class="post-title">Yes we can, yes we cancan</h2>
  
</header>

<p class="post-meta">
  <time datetime="2013-09-27T08:22:00+08:00">Sep 27<span>th</span>, 2013</time>


</p>

<section class="post">
  <div class="post-description">

  
    <p><a href="https://github.com/ryanb/cancan">cancan</a> is an authentication gem for Rails. It can be used to restrict access to certain parts of your web-app based on classifications you give to your users.</p>

<!-- more -->


<p>You can get it working on your app by following the instructions on its <a href="https://github.com/ryanb/cancan#installation">Github page</a>.</p>

<p>cancan allows you to work with two concepts: roles and abilities. A role is a classification that you give to a set of your users, an ability is something users with that role can do.</p>

<p>At Mindvalley we use cancan in a few of our apps. I&rsquo;m currently working on the next version of Daily, our internal reporting service, and we recently realized that we needed to restrict certain types of users from accessing certain reports. cancan to the rescue!</p>

<p>Daily users fall into three distinct roles: managers, marketers and admins. Marketers will not be able to view certain high-level business reports. Admins on the other hand will be able to access everything and be able to change the role of any user.</p>

<p>The way in which you define and assign roles to your users is left up to you. cancan does not provide functionality of that nature. It&rsquo;s useful however to be able to ask a user instance if it belongs to a particular role (if user.marketer?). This is what we have implemented on Daily.</p>

<p>Once you can ask such questions, you use cancan&rsquo;s Ability class to define abilities for each user role. On Daily we have something like:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
</pre></td><td class='code'><pre><code class='ruby'><span class='line'><span class="k">if</span> <span class="n">user</span><span class="o">.</span><span class="n">admin?</span>
</span><span class='line'>  <span class="n">can</span> <span class="ss">:manage</span><span class="p">,</span> <span class="ss">:all</span>
</span><span class='line'><span class="k">elsif</span> <span class="n">user</span><span class="o">.</span><span class="n">manager?</span>
</span><span class='line'>  <span class="n">can</span> <span class="ss">:manage</span><span class="p">,</span> <span class="ss">:all</span>
</span><span class='line'>  <span class="n">cannot</span> <span class="ss">:update</span><span class="p">,</span> <span class="no">User</span>
</span><span class='line'><span class="k">elsif</span> <span class="n">user</span><span class="o">.</span><span class="n">marketer?</span>
</span><span class='line'>  <span class="n">can</span> <span class="ss">:manage</span><span class="p">,</span> <span class="ss">:all</span>
</span><span class='line'>  <span class="n">cannot</span> <span class="ss">:update</span><span class="p">,</span> <span class="no">User</span>
</span><span class='line'>  <span class="n">cannot</span> <span class="ss">:bundles_report</span><span class="p">,</span> <span class="no">ProductLinesClient</span>
</span><span class='line'><span class="k">end</span>
</span></code></pre></td></tr></table></div></figure>




<p><p>This is (almost) understandable just by reading the code out load. &ldquo;Admins can manage everything.&rdquo; &ldquo;Managers can manage everything but they cannot update users&rdquo;. You may be wondering why I&rsquo;ve repeated &ldquo;can :manage, :all&rdquo; three times here. Surely that&rsquo;s not very <abbr title="Don't Repeat Yourself">DRY</abbr>. Well, I feel it reads more naturally this way, and doesn&rsquo;t allow for a user with a rogue role to slip into the system and have access to everything (prizes up for grabs for better solutions though; just send me a pull request ;&ndash;).</p>

<p>The reason I said this is &ldquo;almost&rdquo; readable is because of the last &ldquo;cannot&rdquo; statement. &ldquo;Marketers cannot bundles-report a product-lines-client.&rdquo; What is that supposed to mean?? Well, technically this relates back to the specific method &ldquo;bundles_report&rdquo; on the &ldquo;ProductLinesClient&rdquo; class that returns the report that marketers are not allowed to access. But this unclear naming suggests a <a href="http://www.codinghorror.com/blog/2006/05/code-smells.html">code smell</a>; the way we&rsquo;ve arranged our model classes doesn&rsquo;t map clearly to the types of data we&rsquo;re reporting on. We&rsquo;ll need to look into nipping this naming confusion in the bud in the near future while Daily&rsquo;s code is still new and easily changeable&hellip;</p>

<p>Up next week: saner model structure with the help of <a href="https://github.com/rails/activeresource">ActiveResource</a>? :&ndash;)</p>

  

  </div>
</section>

    <footer>
      <p class="meta">
        
          <a class="basic-alignment left" href="/blog/2013/01/31/perl-tidbit-array-references/" title="Previous Post: Perl tidbit: array references">&laquo; Perl tidbit: array references</a>
           | 
        
        
          <a class="basic-alignment right" href="/blog/2014/01/26/new-blogging-setup/" title="Next Post: New Blogging Setup">New Blogging Setup &raquo;</a>
        
      </p>
    </footer>
  </article>
</div>

        </div>
      </div>
    </div>

    <div class="footer">
  <div class="pure-menu pure-menu-horizontal pure-menu-open">
    <ul>
      <li><a href="/about">About</a></li>
      <li><a href="/projects">Projects</a></li>
      <li><a href="http://github.com/calumhalcrow" target="_new">GitHub</a></li>
      <li><a href="http://twitter.com/calumhalcrow" target="_new">Twitter</a></li>
      <li><a href="http://linkedin.com/calumhalcrow" target="_new">LinkedIn</a></li>
      <li><a href="http://facebook.com/calumhalcrow" target="_new">Facebook</a></li>
    </ul>
  </div>
</div>

  </body>
</html>
